{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Payman","text":"<p>Payman is a modern, unified Python SDK for integrating with Iranian payment gateways. It provides a clean, type-safe, and flexible interface for handling payments in asynchronous Python applications.</p>"},{"location":"#what-is-payman","title":"What is Payman?","text":"<p>Payman simplifies payment gateway integration by providing everything you need to work with popular Iranian payment gateways:</p> <ul> <li>Payment initiation - Create payment requests with a single method call</li> <li>User redirection - Seamlessly redirect users to payment pages</li> <li>Payment verification - Verify completed transactions securely</li> <li>Error handling - Comprehensive error handling with gateway-specific exceptions</li> <li>Type safety - Full Pydantic model support for inputs and outputs</li> </ul> <p>The library abstracts away the complexity of different gateway APIs, providing a consistent interface that works across multiple providers.</p>"},{"location":"#key-features","title":"Key Features","text":""},{"location":"#simple-and-consistent-api","title":"\ud83d\ude80 Simple and Consistent API","text":"<p>Focus on your business logic while Payman handles HTTP calls, serialization, and gateway-specific details internally.</p>"},{"location":"#async-support","title":"\u26a1 Async Support","text":"<p>Compatible with asynchronous code, including FastAPI, and background tasks.</p>"},{"location":"#type-safety-with-pydantic","title":"\ud83d\udee1\ufe0f Type Safety with Pydantic","text":"<p>Type-safe, auto-validating models make integration predictable and IDE-friendly with full autocomplete support.</p>"},{"location":"#modular-and-extensible-design","title":"\ud83d\udd27 Modular and Extensible Design","text":"<p>Each gateway integration is separated. Include only what you need or extend the package with your own gateway implementations.</p>"},{"location":"#unified-error-handling","title":"\ud83c\udfaf Unified Error Handling","text":"<p>Common exception classes across gateways, with optional gateway-specific errors when needed for detailed error handling.</p>"},{"location":"#production-ready","title":"\ud83c\udfd7\ufe0f Production Ready","text":"<p>Designed for real applications, from small services to large-scale deployments with comprehensive logging and retry mechanisms.</p>"},{"location":"#supported-gateways","title":"Supported Gateways","text":"<p>Currently supported payment gateways:</p> <ul> <li>Zibal - Complete integration with all features</li> <li>Zarinpal - Coming soon</li> </ul> <p>More providers (IDPay, NextPay, etc.) are planned for future releases.</p>"},{"location":"#quick-start","title":"Quick Start","text":"<p>Here's how to quickly integrate payments using Zibal:</p> <pre><code>import asyncio\nfrom payman import Payman, GatewayError\n\n# Initialize the payment gateway\npay = Payman(\"zibal\", merchant_id=\"your-merchant-id\")\n\nasync def process_payment():\n    try:\n        # Step 1: Create payment request\n        response = await pay.initiate_payment(\n            amount=25_000,\n            callback_url=\"https://your-site.com/callback\",\n            description=\"Order #123\",\n            order_id=\"order-123\"\n        )\n\n        if not response.success:\n            print(f\"Payment creation failed: {response.message}\")\n            return\n\n        # Step 2: Redirect user to payment page\n        payment_url = pay.get_payment_redirect_url(response.track_id)\n        print(f\"Redirect user to: {payment_url}\")\n\n        # Step 3: Verify payment (after user returns)\n        verify_response = await pay.verify_payment(track_id=response.track_id)\n\n        if verify_response.success:\n            print(f\"Payment successful! Ref ID: {verify_response.ref_number}\")\n        else:\n            print(f\"Payment verification failed: {verify_response.message}\")\n\n    except GatewayError as e:\n        print(f\"Gateway error: {e}\")\n\n# Run the payment flow\nasyncio.run(process_payment())\n</code></pre>"},{"location":"#documentation-sections","title":"Documentation Sections","text":"<p>To help you get started with Payman, check out the following pages:</p> <ul> <li> <p>Installation \u2013 How to install and set up Payman.</p> </li> <li> <p>Usage Guide \u2013 How to work with different gateways.</p> </li> <li> <p>API Reference \u2013 Full reference for all available methods and classes.</p> </li> </ul>"},{"location":"#contributing","title":"Contributing","text":"<p>We welcome contributions, feedback, and bug reports. Visit our GitHub repository to check issues, submit pull requests, or suggest improvements.</p>"},{"location":"#license","title":"License","text":"<p>Payman is licensed under the GNU GPL v3 license. You are free to use, modify, and distribute it under the terms of this license.</p> <p>Need help? Want to request a new gateway? Open an issue on GitHub or contact the maintainer.</p>"},{"location":"api/","title":"Payman API Reference","text":"<p>Welcome to the Payman API documentation. This section provides comprehensive documentation for the unified interface for interacting with multiple Iranian payment gateways.</p>"},{"location":"api/#gateway-specific-documentation","title":"Gateway-Specific Documentation","text":"<p>Each gateway has its own detailed API documentation:</p> <ul> <li>Zibal API - Complete Zibal integration reference</li> <li>Zarinpal API - Coming soon</li> </ul>"},{"location":"api/#core-api-overview","title":"Core API Overview","text":"<p>Payman provides a consistent and developer-friendly API for initiating, verifying, and managing payments across all supported gateways. All gateways follow the same public interface and support asynchronous usage.</p>"},{"location":"api/#main-classes-and-functions","title":"Main Classes and Functions","text":""},{"location":"api/#payman-factory-function","title":"<code>Payman</code> Factory Function","text":"<p>The main entry point for creating gateway instances.</p> <pre><code>from payman import Payman\n\n# Create a gateway instance\ngateway = Payman(\"zibal\", merchant_id=\"your-merchant-id\")\n</code></pre> <p>Parameters: - <code>name</code> (str): Gateway name (\"zibal\", \"zarinpal\", etc.) - <code>merchant_id</code> (str): Your merchant ID for the gateway - <code>**kwargs</code>: Additional gateway-specific parameters</p> <p>Returns: - Gateway instance implementing <code>GatewayInterface</code></p>"},{"location":"api/#gatewayinterface","title":"<code>GatewayInterface</code>","text":"<p>Abstract base class that all payment gateways implement.</p> <pre><code>from payman.interfaces.gateway_base import GatewayInterface\n</code></pre> <p>Methods: - <code>initiate_payment(request, **kwargs)</code> - Create a new payment - <code>verify_payment(request, **kwargs)</code> - Verify a payment - <code>get_payment_redirect_url(token)</code> - Get payment page URL</p>"},{"location":"api/#core-exceptions","title":"Core Exceptions","text":""},{"location":"api/#gatewayerror","title":"<code>GatewayError</code>","text":"<p>Base exception for all gateway-related errors.</p> <pre><code>from payman import GatewayError\n\ntry:\n    response = await gateway.initiate_payment(...)\nexcept GatewayError as e:\n    print(f\"Gateway error: {e}\")\n</code></pre>"},{"location":"api/#http-exceptions","title":"HTTP Exceptions","text":"<pre><code>from payman.core.exceptions.http import (\n    HttpClientError,\n    HttpStatusError,\n    TimeoutError,\n    InvalidJsonError\n)\n</code></pre>"},{"location":"api/#utility-functions","title":"Utility Functions","text":""},{"location":"api/#to_model_instance","title":"<code>to_model_instance</code>","text":"<p>Convert various input types to Pydantic model instances.</p> <pre><code>from payman.utils import to_model_instance\nfrom zibal.models import PaymentRequest\n\n# Convert dict to model\ndata = {\"amount\": 1000, \"callback_url\": \"https://example.com\"}\nrequest = to_model_instance(data, PaymentRequest)\n\n# Convert with overrides\nrequest = to_model_instance(None, PaymentRequest, amount=1000, callback_url=\"https://example.com\")\n</code></pre>"},{"location":"api/#gateway-registration","title":"Gateway Registration","text":""},{"location":"api/#register_gateway","title":"<code>register_gateway</code>","text":"<p>Register a new payment gateway dynamically.</p> <pre><code>from payman.core.gateways.register_gateway import register_gateway\n\n# Register a custom gateway\nregister_gateway(\"mygateway\", \"mypackage.gateway.MyGateway\")\n</code></pre>"},{"location":"api/#get_gateway_instance","title":"<code>get_gateway_instance</code>","text":"<p>Get a gateway instance by name.</p> <pre><code>from payman.core.gateways.register_gateway import get_gateway_instance\n\ngateway = get_gateway_instance(\"zibal\", merchant_id=\"your-id\")\n</code></pre>"},{"location":"api/#http-client","title":"HTTP Client","text":""},{"location":"api/#asynchttpclient","title":"<code>AsyncHttpClient</code>","text":"<p>Asynchronous HTTP client with retry, logging, and session management.</p> <pre><code>from payman.core.http.client import AsyncHttpClient\n\nclient = AsyncHttpClient(\n    base_url=\"https://api.example.com\",\n    timeout=10.0,\n    max_retries=3,\n    retry_delay=1.0\n)\n\nasync with client:\n    response = await client.request(\"POST\", \"/payments\", json_data={\"amount\": 1000})\n</code></pre> <p>Parameters: - <code>base_url</code> (str, optional): Base URL for requests - <code>timeout</code> (float): Request timeout in seconds (default: 10.0) - <code>slow_request_threshold</code> (float): Threshold for slow request warnings (default: 3.0) - <code>max_retries</code> (int): Maximum retry attempts (default: 0) - <code>retry_delay</code> (float): Delay between retries in seconds (default: 1.0) - <code>log_level</code> (int): Logging level (default: 20) - <code>log_req_body</code> (bool): Log request bodies (default: True) - <code>log_resp_body</code> (bool): Log response bodies (default: True)</p>"},{"location":"api/#type-hints-and-models","title":"Type Hints and Models","text":"<p>Payman uses Pydantic models for type safety and validation. All request and response models are fully typed and validated.</p>"},{"location":"api/#example-with-type-hints","title":"Example with Type Hints","text":"<pre><code>from typing import Optional\nfrom payman import Payman\nfrom zibal.models import PaymentRequest, PaymentResponse\n\nasync def process_payment(\n    amount: int,\n    callback_url: str,\n    description: Optional[str] = None\n) -&gt; PaymentResponse:\n    gateway = Payman(\"zibal\", merchant_id=\"your-id\")\n\n    request = PaymentRequest(\n        amount=amount,\n        callback_url=callback_url,\n        description=description\n    )\n\n    return await gateway.initiate_payment(request)\n</code></pre>"},{"location":"api/#error-handling-patterns","title":"Error Handling Patterns","text":""},{"location":"api/#basic-error-handling","title":"Basic Error Handling","text":"<pre><code>from payman import GatewayError\nfrom zibal.exceptions import PaymentNotSuccessfulError\n\ntry:\n    response = await gateway.initiate_payment(...)\nexcept PaymentNotSuccessfulError as e:\n    # Handle payment-specific errors\n    print(f\"Payment failed: {e.message}\")\nexcept GatewayError as e:\n    # Handle general gateway errors\n    print(f\"Gateway error: {e}\")\nexcept Exception as e:\n    # Handle unexpected errors\n    print(f\"Unexpected error: {e}\")\n</code></pre>"},{"location":"api/#advanced-error-handling","title":"Advanced Error Handling","text":"<pre><code>from payman.core.exceptions.http import HttpStatusError, TimeoutError\n\ntry:\n    response = await gateway.initiate_payment(...)\nexcept HttpStatusError as e:\n    print(f\"HTTP error {e.status_code}: {e.message}\")\n    if e.body:\n        print(f\"Response body: {e.body}\")\nexcept TimeoutError as e:\n    print(f\"Request timed out: {e}\")\nexcept Exception as e:\n    print(f\"Unexpected error: {e}\")\n</code></pre>"},{"location":"api/#configuration-and-environment","title":"Configuration and Environment","text":""},{"location":"api/#environment-variables","title":"Environment Variables","text":"<pre><code>import os\nfrom payman import Payman\n\n# Use environment variables for sensitive data\nmerchant_id = os.getenv(\"ZIBAL_MERCHANT_ID\")\ngateway = Payman(\"zibal\", merchant_id=merchant_id)\n</code></pre>"},{"location":"api/#testing-utilities","title":"Testing Utilities","text":""},{"location":"api/#mock-gateway-for-testing","title":"Mock Gateway for Testing","text":"<pre><code>from unittest.mock import AsyncMock\nfrom payman import Payman\n\ndef create_mock_gateway():\n    gateway = Payman(\"zibal\", merchant_id=\"test\")\n    gateway.initiate_payment = AsyncMock(return_value=MockResponse(success=True))\n    gateway.verify_payment = AsyncMock(return_value=MockVerifyResponse(success=True))\n    return gateway\n</code></pre>"},{"location":"api/#test-configuration","title":"Test Configuration","text":"<pre><code>import pytest\nfrom payman import Payman\n\n@pytest.fixture\ndef test_gateway():\n    return Payman(\"zibal\", merchant_id=\"zibal\")  # Sandbox mode\n\nasync def test_payment_flow(test_gateway):\n    response = await test_gateway.initiate_payment(\n        amount=1000,\n        callback_url=\"https://example.com/callback\"\n    )\n    assert response.success\n</code></pre>"},{"location":"api/#performance-considerations","title":"Performance Considerations","text":""},{"location":"api/#connection-pooling","title":"Connection Pooling","text":"<p>The HTTP client automatically manages connection pooling for better performance:</p> <pre><code># Client reuses connections automatically\ngateway = Payman(\"zibal\", merchant_id=\"your-id\")\n\n# Multiple requests will reuse the same connection\nfor i in range(10):\n    response = await gateway.initiate_payment(...)\n</code></pre>"},{"location":"api/#async-context-management","title":"Async Context Management","text":"<p>Always use async context managers for proper resource cleanup:</p> <pre><code>async with gateway:\n    response = await gateway.initiate_payment(...)\n# Client is automatically closed\n</code></pre>"},{"location":"api/#migration-guide","title":"Migration Guide","text":""},{"location":"api/#from-v2-to-v3","title":"From v2 to v3","text":"<pre><code># Old v2 syntax\nfrom payman import Payman\nfrom payman.gateways.zibal.models import RequestPayment\ngateway = Payman(\"zibal\", merchant_id=\"your-id\")\nresponse = await gateway.payment(RequestPayment(...))\n\n# New v3 syntax\nfrom payman import Payman\nfrom zibal.models import PaymentRequest  # provided by `pip install payman[zibal]`\ngateway = Payman(\"zibal\", merchant_id=\"your-id\")\nresponse = await gateway.initiate_payment(RequestPayment(...))\n</code></pre>"},{"location":"api/#contributing","title":"Contributing","text":"<p>To contribute new gateways or features:</p> <ol> <li>Implement the <code>GatewayInterface</code></li> <li>Register your gateway using <code>register_gateway</code></li> <li>Add comprehensive tests</li> <li>Update documentation</li> </ol>"},{"location":"installation/","title":"Installation","text":"<p>This page will help you install and set up Payman in your Python project in just a few steps.</p>"},{"location":"installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.10 or higher - Payman uses modern Python features and type hints</li> <li>pip - Python package installer</li> </ul> <p>Check your Python version:</p> <pre><code>python --version\n# or\npython3 --version\n</code></pre>"},{"location":"installation/#installation-methods","title":"Installation Methods","text":""},{"location":"installation/#method-1-install-from-pypi-recommended","title":"Method 1: Install from PyPI (Recommended)","text":"<p>The easiest way to install Payman is via PyPI:</p> <pre><code>pip install payman\n</code></pre>"},{"location":"installation/#if-you-need-a-specific-payment-gateway-plugin-eg-zibal-install-payman-with-extras","title":"\ud83d\udc49 If you need a specific payment gateway plugin (e.g., Zibal), install Payman with extras:","text":"<pre><code>pip install payman[zibal]\n</code></pre>"},{"location":"installation/#method-2-install-from-github-development","title":"Method 2: Install from GitHub (Development)","text":"<p>If you want the latest development version with bleeding-edge features:</p> <pre><code>pip install git+https://github.com/irvaniamirali/payman.git\n</code></pre>"},{"location":"installation/#method-3-install-from-source","title":"Method 3: Install from Source","text":"<p>For development or if you want to modify the source code:</p> <pre><code>git clone https://github.com/irvaniamirali/payman.git\ncd payman\npip install -e .\n</code></pre>"},{"location":"installation/#virtual-environment-setup-recommended","title":"Virtual Environment Setup (Recommended)","text":"<p>It's highly recommended to use a virtual environment to keep dependencies isolated:</p>"},{"location":"installation/#using-venv-built-in","title":"Using <code>venv</code> (Built-in)","text":"<pre><code># Create virtual environment\npython -m venv payman-env\n\n# Activate (Linux/macOS)\nsource payman-env/bin/activate\n\n# Activate (Windows)\npayman-env\\Scripts\\activate\n\n# Install Payman\npip install payman\n</code></pre>"},{"location":"installation/#using-uv-fast","title":"Using <code>uv</code> (Fast)","text":"<pre><code># Create and activate environment\nuv venv payman-env\nsource payman-env/bin/activate  # Linux/macOS\n# payman-env\\Scripts\\activate   # Windows\n\n# Install Payman\nuv pip install payman\n</code></pre>"},{"location":"installation/#verify-installation","title":"Verify Installation","text":"<p>Test your installation by running this simple script:</p> <pre><code>from payman import Payman\n\n# This should work without errors\npay = Payman(\"zibal\", merchant_id=\"test\")\nprint(\"Payman installed successfully!\")\n</code></pre>"},{"location":"installation/#dependencies","title":"Dependencies","text":"<p>Payman automatically installs these dependencies:</p> <ul> <li>pydantic - Data validation and settings management</li> <li>httpx - Modern HTTP client for async requests</li> <li>email-validator - Email validation support</li> <li>typing-extensions - Extended typing support</li> </ul>"},{"location":"installation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"installation/#common-issues","title":"Common Issues","text":"<p>ImportError: No module named 'payman' - Make sure you're in the correct virtual environment - Verify installation with <code>pip list | grep payman</code></p> <p>Python version too old - Payman requires Python 3.10+ - Upgrade Python or use a version manager like <code>pyenv</code></p> <p>Permission denied errors - Use <code>--user</code> flag: <code>pip install --user payman</code> - Or use a virtual environment (recommended)</p>"},{"location":"installation/#getting-help","title":"Getting Help","text":"<p>If you encounter issues:</p> <ol> <li>Check the GitHub Issues</li> <li>Review the Usage Guide</li> <li>Join our community discussions</li> </ol>"},{"location":"installation/#next-steps","title":"Next Steps","text":"<p>Once installed, you can:</p> <ol> <li>Read the Usage Guide to learn how to integrate payments</li> <li>Check out the API Reference for detailed documentation</li> <li>Explore Zibal Integration for specific gateway usage</li> </ol>"},{"location":"usage/","title":"Usage Guide","text":"<p>This comprehensive guide will help you understand how to use Payman in your project and integrate with specific payment gateways.</p>"},{"location":"usage/#supported-gateways","title":"Supported Gateways","text":"<p>Each gateway comes with its own detailed usage guide and example code:</p> <ul> <li>Zibal - Complete integration with all features</li> <li>Zarinpal - Coming soon</li> </ul>"},{"location":"usage/#common-payment-workflow","title":"Common Payment Workflow","text":"<p>Regardless of the gateway, the typical payment flow follows these steps:</p> <ol> <li>Initialize Gateway - Create a Payman instance with your credentials</li> <li>Create Payment Request - Send payment details to the gateway</li> <li>Redirect User - Send user to the payment page</li> <li>Handle Callback - Process the return from the payment gateway</li> <li>Verify Payment - Confirm the transaction was successful</li> </ol> <p>Payman standardizes this flow across all gateways, making it easy to switch between providers.</p>"},{"location":"usage/#basic-usage-patterns","title":"Basic Usage Patterns","text":""},{"location":"usage/#1-gateway-initialization","title":"1. Gateway Initialization","text":"<pre><code>from payman import Payman\n\n# Initialize Zibal gateway\npay = Payman(\"zibal\", merchant_id=\"your-merchant-id\")\n\n# For testing, use sandbox mode\npay = Payman(\"zibal\", merchant_id=\"zibal\")  # Sandbox mode\n</code></pre>"},{"location":"usage/#2-payment-creation","title":"2. Payment Creation","text":"<pre><code>response = await pay.initiate_payment(\n    amount=10_000,\n    callback_url=\"https://your-site.com/callback\",\n    description=\"Order #123\",\n    order_id=\"order-123\"\n)\n</code></pre>"},{"location":"usage/#3-user-redirection","title":"3. User Redirection","text":"<pre><code>if response.success:\n    payment_url = pay.get_payment_redirect_url(response.track_id)\n    # Redirect user to payment_url\n    print(f\"Redirect user to: {payment_url}\")\n</code></pre>"},{"location":"usage/#4-payment-verification","title":"4. Payment Verification","text":"<pre><code># After user returns from payment gateway\nverify_response = await pay.verify_payment(track_id=response.track_id)\n\nif verify_response.success:\n    print(f\"Payment successful! Ref: {verify_response.ref_number}\")\nelse:\n    print(f\"Payment failed: {verify_response.message}\")\n</code></pre>"},{"location":"usage/#input-flexibility","title":"Input Flexibility","text":"<p>Payman supports multiple input formats for maximum flexibility:</p>"},{"location":"usage/#pydantic-models","title":"Pydantic Models","text":"<pre><code>from zibal.models import PaymentRequest\n\nrequest = PaymentRequest(\n    amount=10_000,\n    callback_url=\"https://site.com/callback\",\n    description=\"Test payment\"\n)\nresponse = await pay.initiate_payment(request)\n</code></pre>"},{"location":"usage/#dictionary-input","title":"Dictionary Input","text":"<pre><code>request_data = {\n    \"amount\": 10_000,\n    \"callback_url\": \"https://site.com/callback\",\n    \"description\": \"Test payment\"\n}\nresponse = await pay.initiate_payment(request_data)\n</code></pre>"},{"location":"usage/#keyword-arguments","title":"Keyword Arguments","text":"<pre><code>response = await pay.initiate_payment(\n    amount=10_000,\n    callback_url=\"https://site.com/callback\",\n    description=\"Test payment\"\n)\n</code></pre>"},{"location":"usage/#error-handling","title":"Error Handling","text":"<p>Payman provides comprehensive error handling:</p> <pre><code>from payman import GatewayError\nfrom zibal.exceptions import PaymentNotSuccessfulError\n\ntry:\n    response = await pay.initiate_payment(...)\nexcept GatewayError as e:\n    print(f\"Gateway error: {e}\")\nexcept PaymentNotSuccessfulError as e:\n    print(f\"Payment failed: {e.message}\")\nexcept Exception as e:\n    print(f\"Unexpected error: {e}\")\n</code></pre>"},{"location":"usage/#advanced-features","title":"Advanced Features","text":""},{"location":"usage/#custom-http-client-configuration","title":"Custom HTTP Client Configuration","text":"<pre><code>from payman import Payman\n\n# Configure HTTP client with custom settings\npay = Payman(\n    \"zibal\", \n    merchant_id=\"your-merchant-id\",\n    timeout=30.0,\n    max_retries=3,\n    retry_delay=1.0\n)\n</code></pre>"},{"location":"usage/#logging-configuration","title":"Logging Configuration","text":"<pre><code>import logging\n\n# Configure logging for Payman\nlogging.basicConfig(level=logging.DEBUG)\nlogger = logging.getLogger(\"payman\")\n\n# Payman will automatically use the configured logger\n</code></pre>"},{"location":"usage/#testing","title":"Testing","text":""},{"location":"usage/#sandbox-mode","title":"Sandbox Mode","text":"<p>For testing, use sandbox mode:</p> <pre><code># Zibal sandbox mode\npay = Payman(\"zibal\", merchant_id=\"zibal\")\n\n# This will use mock responses for testing\nresponse = await pay.initiate_payment(\n    amount=10_000,\n    callback_url=\"https://your-site.com/callback\"\n)\n</code></pre>"},{"location":"usage/#best-practices","title":"Best Practices","text":"<ol> <li>Always use HTTPS for callback URLs in production</li> <li>Validate amounts before sending to the gateway</li> <li>Store track_id securely for verification</li> <li>Handle all exceptions gracefully</li> <li>Use environment variables for sensitive data</li> <li>Test thoroughly in sandbox mode before going live</li> <li>Implement proper logging for debugging and monitoring</li> </ol>"},{"location":"usage/#next-steps","title":"Next Steps","text":"<ul> <li>Explore Zibal Integration for detailed Zibal-specific features</li> <li>Check the API Reference for complete method documentation</li> <li>Review examples for real-world implementation patterns</li> </ul>"},{"location":"gateways/zibal/api/","title":"Zibal API Reference","text":"<p>This page documents the available methods and data models for the Zibal payment gateway integration using the Payman package. It includes detailed parameter tables, response models, and exception mappings.</p>"},{"location":"gateways/zibal/api/#gateway-instantiation","title":"Gateway Instantiation","text":""},{"location":"gateways/zibal/api/#using-payman-factory-recommended","title":"Using Payman Factory (Recommended)","text":"<p>The recommended way to create a Zibal gateway instance:</p> <pre><code>from payman import Payman\n\n# Production mode\npay = Payman(\"zibal\", merchant_id=\"your-merchant-id\")\n\n# Sandbox mode for testing\npay = Payman(\"zibal\", merchant_id=\"zibal\")\n</code></pre>"},{"location":"gateways/zibal/api/#direct-instantiation","title":"Direct Instantiation","text":"<p>You can also instantiate the Zibal gateway directly (though not recommended for consistency):</p> <pre><code>from zibal import Zibal\n\npay = Zibal(merchant_id=\"your-merchant-id\")\n</code></pre>"},{"location":"gateways/zibal/api/#core-methods","title":"Core Methods","text":""},{"location":"gateways/zibal/api/#initiate_paymentrequest-paymentrequest-dict-none-none-kwargs-paymentresponse","title":"<code>initiate_payment(request: PaymentRequest | dict | None = None, **kwargs) -&gt; PaymentResponse</code>","text":"<p>Initiates a new payment request to Zibal.</p>"},{"location":"gateways/zibal/api/#parameters","title":"Parameters","text":"<p><code>request</code> (<code>PaymentRequest</code> | <code>dict</code> | <code>None</code>)</p> Field Type Required Description <code>amount</code> <code>int</code> (\u2265 100) \u2705 Payment amount in Rial (minimum: 100) <code>callback_url</code> <code>HttpUrl</code> \u2705 URL to redirect the user after payment <code>description</code> <code>str \\| None</code> \u274c Optional payment description <code>order_id</code> <code>str \\| None</code> \u274c Optional merchant order identifier <code>mobile</code> <code>constr(min_length=11, max_length=11, pattern=\"^09\\d{9}$\") \\| None</code> \u274c Optional buyer mobile number <code>allowed_cards</code> <code>List[constr(min_length=16, max_length=16, pattern=\"^\\d{16}$\")]\\| None</code> \u274c Optional list of allowed card PANs <code>ledger_id</code> <code>str \\| None</code> \u274c Optional ledger identifier <code>national_code</code> <code>constr(min_length=10, max_length=10, pattern=\"^\\d{10}$\") \\| None</code> \u274c Optional national code of the buyer <code>check_mobile_with_card</code> <code>bool \\| None</code> \u274c Optional mobile/card cross-check flag <code>percent_mode</code> <code>Literal[0,1]</code> (default: <code>0</code>) \u274c Revenue-sharing mode: 0=fixed, 1=percent <code>fee_mode</code> <code>Literal[0,1,2]</code> (default: <code>0</code>) \u274c Fee payer mode: 0=shopper, 1=merchant, 2=split <code>multiplexingInfos</code> <code>List[MultiplexingInfo]</code> (default: <code>[]</code>) \u274c Optional multiplexing (split payment) configuration"},{"location":"gateways/zibal/api/#returns","title":"Returns","text":"<p><code>PaymentResponse</code></p> Field Type Description <code>success</code> <code>bool</code> Whether the payment request was successful <code>track_id</code> <code>int</code> Unique transaction tracking ID <code>message</code> <code>str</code> Human-readable result message <code>status</code> <code>int</code> Response status code"},{"location":"gateways/zibal/api/#example-usage","title":"Example Usage","text":"<pre><code># Using keyword arguments\nresponse = await pay.initiate_payment(\n    amount=10_000,\n    callback_url=\"https://example.com/callback\",\n    description=\"Test Payment\",\n    order_id=\"order-123\"\n)\n\n# Using Pydantic model\nfrom zibal.models import PaymentRequest\n\nrequest = PaymentRequest(\n    amount=10_000,\n    callback_url=\"https://example.com/callback\",\n    description=\"Test Payment\"\n)\nresponse = await pay.initiate_payment(request)\n\n# Using dictionary\nrequest_data = {\n    \"amount\": 10_000,\n    \"callback_url\": \"https://example.com/callback\",\n    \"description\": \"Test Payment\"\n}\nresponse = await pay.initiate_payment(request_data)\n</code></pre>"},{"location":"gateways/zibal/api/#raises","title":"Raises","text":"<ul> <li><code>GatewayError</code> - Base gateway error</li> <li><code>ZibalError</code> - Zibal-specific errors and subclasses</li> </ul>"},{"location":"gateways/zibal/api/#verify_paymentrequest-verifyrequest-dict-none-none-kwargs-verifyresponse","title":"<code>verify_payment(request: VerifyRequest | dict | None = None, **kwargs) -&gt; VerifyResponse</code>","text":"<p>Verifies payment after user redirect or callback.</p>"},{"location":"gateways/zibal/api/#parameters_1","title":"Parameters","text":"<p><code>request</code> (<code>VerifyRequest</code> | <code>dict</code> | <code>None</code>)</p> Field Type Required Description <code>track_id</code> <code>int</code> \u2705 Transaction tracking ID returned by Zibal"},{"location":"gateways/zibal/api/#returns_1","title":"Returns","text":"<p><code>VerifyResponse</code></p> Field Type Description <code>success</code> <code>bool</code> Whether verification was successful <code>result</code> <code>int</code> Response status code (100 = success) <code>message</code> <code>str</code> Result message <code>amount</code> <code>int \\| None</code> Paid amount in Rial <code>status</code> <code>int \\| None</code> Bank transaction status (1=success,2=canceled) <code>paid_at</code> <code>str \\| None</code> ISO 8601 payment timestamp <code>card_number</code> <code>str \\| None</code> Masked payer card number <code>ref_number</code> <code>str \\| None</code> Bank reference number <code>order_id</code> <code>str \\| None</code> Merchant order ID <code>description</code> <code>str \\| None</code> Additional description <code>track_id</code> <code>int \\| None</code> Tracking ID <code>multiplexingInfos</code> <code>List[MultiplexingInfo]</code> Optional split payment details"},{"location":"gateways/zibal/api/#example-usage_1","title":"Example Usage","text":"<pre><code># Using keyword arguments\nverify_response = await pay.verify_payment(track_id=123456)\n\n# Using Pydantic model\nfrom zibal.models import VerifyRequest\n\nverify_request = VerifyRequest(track_id=123456)\nverify_response = await pay.verify_payment(verify_request)\n\n# Check if verification was successful\nif verify_response.success:\n    print(f\"Payment verified! Ref: {verify_response.ref_number}\")\n    print(f\"Amount: {verify_response.amount} IRR\")\nelse:\n    print(f\"Verification failed: {verify_response.message}\")\n</code></pre>"},{"location":"gateways/zibal/api/#raises_1","title":"Raises","text":"<ul> <li><code>GatewayError</code> - Base gateway error</li> <li><code>PaymentNotSuccessfulError</code> - Payment was not successful</li> <li><code>InvalidTrackIdError</code> - Invalid track ID provided</li> </ul>"},{"location":"gateways/zibal/api/#get_payment_redirect_urltrack_id-int-str","title":"<code>get_payment_redirect_url(track_id: int) -&gt; str</code>","text":"<p>Builds the URL for redirecting the user to Zibal's payment page.</p>"},{"location":"gateways/zibal/api/#parameters_2","title":"Parameters","text":"<ul> <li><code>track_id</code> (<code>int</code>): Tracking ID from <code>initiate_payment()</code></li> </ul>"},{"location":"gateways/zibal/api/#returns_2","title":"Returns","text":"<ul> <li><code>str</code>: Complete redirect URL</li> </ul>"},{"location":"gateways/zibal/api/#example","title":"Example","text":"<pre><code>track_id = 123456\npayment_url = pay.get_payment_redirect_url(track_id)\nprint(payment_url)  # https://gateway.zibal.ir/start/123456\n</code></pre>"},{"location":"gateways/zibal/api/#advanced-methods","title":"Advanced Methods","text":""},{"location":"gateways/zibal/api/#inquiryrequest-inquiryrequest-dict-none-none-kwargs-inquiryresponse","title":"<code>inquiry(request: InquiryRequest | dict | None = None, **kwargs) -&gt; InquiryResponse</code>","text":"<p>Fetches current transaction status without verification.</p>"},{"location":"gateways/zibal/api/#parameters_3","title":"Parameters","text":"<p><code>request</code> (<code>InquiryRequest</code> | <code>dict</code> | <code>None</code>)</p> Field Type Required Description <code>track_id</code> <code>int</code> \u2705 Transaction tracking ID"},{"location":"gateways/zibal/api/#returns_3","title":"Returns","text":"<p><code>InquiryResponse</code></p> Field Type Description <code>result</code> <code>int</code> Response status code <code>message</code> <code>str</code> Status message <code>ref_number</code> <code>int \\| None</code> Bank reference number <code>paid_at</code> <code>str \\| None</code> Payment timestamp (ISO 8601) <code>verified_at</code> <code>str \\| None</code> Verification timestamp <code>status</code> <code>int</code> Payment status <code>amount</code> <code>int</code> Amount of transaction <code>order_id</code> <code>str</code> Merchant order ID <code>description</code> <code>str</code> Transaction description <code>card_number</code> <code>str \\| None</code> Masked card number <code>wage</code> <code>int</code> Associated wage <code>created_at</code> <code>str</code> Transaction creation timestamp <code>multiplexingInfos</code> <code>List[MultiplexingInfo]</code> Revenue sharing details"},{"location":"gateways/zibal/api/#data-models","title":"Data Models","text":""},{"location":"gateways/zibal/api/#paymentrequest","title":"<code>PaymentRequest</code>","text":"<p>Request model for initiating payments.</p> <pre><code>from zibal.models import PaymentRequest\n\nrequest = PaymentRequest(\n    amount=10_000,\n    callback_url=\"https://example.com/callback\",\n    description=\"Test Payment\",\n    order_id=\"order-123\",\n    mobile=\"09123456789\"\n)\n</code></pre>"},{"location":"gateways/zibal/api/#paymentresponse","title":"<code>PaymentResponse</code>","text":"<p>Response model for payment initiation.</p> <pre><code>from zibal.models import PaymentResponse\n\n# Response fields\nresponse.success  # bool\nresponse.track_id  # int\nresponse.message  # str\nresponse.status  # int\n</code></pre>"},{"location":"gateways/zibal/api/#verifyrequest","title":"<code>VerifyRequest</code>","text":"<p>Request model for payment verification.</p> <pre><code>from zibal.models import VerifyRequest\n\nrequest = VerifyRequest(track_id=123456)\n</code></pre>"},{"location":"gateways/zibal/api/#verifyresponse","title":"<code>VerifyResponse</code>","text":"<p>Response model for payment verification.</p> <pre><code>from zibal.models import VerifyResponse\n\n# Response fields\nresponse.success  # bool\nresponse.result  # int\nresponse.message  # str\nresponse.amount  # int | None\nresponse.ref_number  # str | None\nresponse.paid_at  # str | None\n# ... and more\n</code></pre>"},{"location":"gateways/zibal/api/#callbackparams","title":"<code>CallbackParams</code>","text":"<p>Model for handling callback parameters.</p> <pre><code>from zibal.models import CallbackParams\n\n# From query parameters\ncallback = CallbackParams(\n    track_id=123456,\n    success=1,\n    status=100,\n    order_id=\"order-123\"\n)\n\nif callback.is_success:\n    print(\"Payment was successful\")\n</code></pre>"},{"location":"gateways/zibal/api/#exception-handling","title":"Exception Handling","text":"<p>All Zibal-specific errors inherit from <code>ZibalError</code>. The gateway automatically raises the proper subclass based on the status code.</p>"},{"location":"gateways/zibal/api/#error-hierarchy","title":"Error Hierarchy","text":"<pre><code>GatewayError (base)\n\u2514\u2500\u2500 ZibalError\n    \u251c\u2500\u2500 MerchantNotFoundError\n    \u251c\u2500\u2500 MerchantInactiveError\n    \u251c\u2500\u2500 InvalidMerchantError\n    \u251c\u2500\u2500 AmountTooLowError\n    \u251c\u2500\u2500 InvalidCallbackUrlError\n    \u251c\u2500\u2500 InvalidPercentModeError\n    \u251c\u2500\u2500 InvalidMultiplexingBeneficiariesError\n    \u251c\u2500\u2500 InactiveMultiplexingBeneficiaryError\n    \u251c\u2500\u2500 MissingSelfBeneficiaryError\n    \u251c\u2500\u2500 AmountMismatchInMultiplexingError\n    \u251c\u2500\u2500 InsufficientWalletBalanceForFeesError\n    \u251c\u2500\u2500 AmountExceedsLimitError\n    \u251c\u2500\u2500 InvalidNationalCodeError\n    \u251c\u2500\u2500 AlreadyConfirmedError\n    \u251c\u2500\u2500 PaymentNotSuccessfulError\n    \u2514\u2500\u2500 InvalidTrackIdError\n</code></pre>"},{"location":"gateways/zibal/api/#error-handling-example","title":"Error Handling Example","text":"<pre><code>from payman import GatewayError\nfrom zibal.exceptions import (\n    PaymentNotSuccessfulError,\n    InvalidTrackIdError,\n    AmountTooLowError\n)\n\ntry:\n    response = await pay.initiate_payment(\n        amount=50,  # Too low\n        callback_url=\"https://example.com/callback\"\n    )\nexcept AmountTooLowError as e:\n    print(f\"Amount too low: {e.message}\")\nexcept PaymentNotSuccessfulError as e:\n    print(f\"Payment failed: {e.message}\")\nexcept InvalidTrackIdError as e:\n    print(f\"Invalid track ID: {e.message}\")\nexcept GatewayError as e:\n    print(f\"Gateway error: {e}\")\nexcept Exception as e:\n    print(f\"Unexpected error: {e}\")\n</code></pre>"},{"location":"gateways/zibal/api/#sandbox-testing","title":"Sandbox Testing","text":""},{"location":"gateways/zibal/api/#test-mode-configuration","title":"Test Mode Configuration","text":"<p>To use Zibal in sandbox mode, set your <code>merchant_id</code> to the string <code>\"zibal\"</code>:</p> <pre><code>from payman import Payman\n\n# Sandbox mode\npay = Payman(\"zibal\", merchant_id=\"zibal\")\n\n# This will use mock responses for testing\nresponse = await pay.initiate_payment(\n    amount=10_000,\n    callback_url=\"https://example.com/callback\"\n)\n</code></pre>"},{"location":"gateways/zibal/api/#configuration-options","title":"Configuration Options","text":""},{"location":"gateways/zibal/api/#http-client-configuration","title":"HTTP Client Configuration","text":"<pre><code>from payman import Payman\n\n# Configure HTTP client with custom settings\npay = Payman(\n    \"zibal\", \n    merchant_id=\"your-merchant-id\",\n    timeout=30.0,           # Request timeout in seconds\n    max_retries=3,          # Maximum retry attempts\n    retry_delay=1.0,        # Delay between retries\n    log_level=20,           # Logging level\n    log_req_body=True,      # Log request bodies\n    log_resp_body=True      # Log response bodies\n)\n</code></pre>"},{"location":"gateways/zibal/api/#environment-variables","title":"Environment Variables","text":"<pre><code>import os\nfrom payman import Payman\n\n# Use environment variables for configuration\nmerchant_id = os.getenv(\"ZIBAL_MERCHANT_ID\", \"zibal\")  # Default to sandbox\npay = Payman(\"zibal\", merchant_id=merchant_id)\n</code></pre>"},{"location":"gateways/zibal/api/#performance-considerations","title":"Performance Considerations","text":""},{"location":"gateways/zibal/api/#connection-pooling","title":"Connection Pooling","text":"<p>The HTTP client automatically manages connection pooling:</p> <pre><code># Client reuses connections automatically\npay = Payman(\"zibal\", merchant_id=\"your-id\")\n\n# Multiple requests will reuse the same connection\nfor i in range(10):\n    response = await pay.initiate_payment(...)\n</code></pre>"},{"location":"gateways/zibal/api/#async-context-management","title":"Async Context Management","text":"<p>Always use async context managers for proper resource cleanup:</p> <pre><code>async with pay:\n    response = await pay.initiate_payment(...)\n# Client is automatically closed\n</code></pre>"},{"location":"gateways/zibal/api/#migration-from-v2","title":"Migration from v2","text":"<p>If you're migrating from Payman v2:</p> <pre><code># Old v2 syntax\nfrom payman import Zibal\ngateway = Zibal(merchant_id=\"your-id\")\nresponse = await gateway.payment(...)\n\n# New v3 syntax\nfrom payman import Payman\ngateway = Payman(\"zibal\", merchant_id=\"your-id\")\nresponse = await gateway.initiate_payment(...)\n</code></pre>"},{"location":"gateways/zibal/api/#troubleshooting","title":"Troubleshooting","text":""},{"location":"gateways/zibal/api/#common-issues","title":"Common Issues","text":"<ol> <li>ImportError: No module named 'zibal'</li> <li>Make sure you have the zibal package installed</li> <li> <p>Check your Python environment</p> </li> <li> <p>ValidationError on payment creation</p> </li> <li>Verify all required fields are provided</li> <li> <p>Check field types and formats</p> </li> <li> <p>GatewayError during verification</p> </li> <li>Ensure track_id is valid and not expired</li> <li>Check if payment was actually completed</li> </ol>"},{"location":"gateways/zibal/api/#debug-mode","title":"Debug Mode","text":"<p>Enable debug logging to troubleshoot issues:</p> <pre><code>import logging\n\n# Enable debug logging\nlogging.basicConfig(level=logging.DEBUG)\nlogger = logging.getLogger(\"payman\")\n\n# Your payment code here\n</code></pre>"},{"location":"gateways/zibal/api/#support","title":"Support","text":"<p>For additional help:</p> <ul> <li>Check the Usage Guide for integration examples</li> <li>Review Error Handling Patterns</li> <li>See Real-world Examples for complete implementations</li> <li>Open an issue on GitHub</li> </ul>"},{"location":"gateways/zibal/usage/","title":"Using Zibal Gateway with Payman","text":"<p>This comprehensive guide shows you how to integrate the Zibal payment gateway using the Payman Python package. You'll find examples for asynchronous usage to suit various application types.</p>"},{"location":"gateways/zibal/usage/#quick-start-guide","title":"Quick Start Guide","text":"<p>Follow these simple steps to integrate Zibal payment gateway with Payman:</p>"},{"location":"gateways/zibal/usage/#1-initialize-the-gateway","title":"1. Initialize the Gateway","text":"<p>Import <code>Payman</code> and create an instance with your merchant ID:</p> <pre><code>from payman import Payman\n\n# Production mode\npay = Payman(\"zibal\", merchant_id=\"YOUR-MERCHANT-ID\")\n\n# Test/sandbox mode\npay = Payman(\"zibal\", merchant_id=\"zibal\")\n</code></pre>"},{"location":"gateways/zibal/usage/#test-mode-for-development","title":"Test Mode for Development","text":"<p>Zibal provides a test mode that allows you to safely test payment flows without real transactions. To use Zibal in test mode, set your <code>merchant_id</code> to the string \"zibal\":</p> <pre><code>from payman import Payman\n\npay = Payman(\"zibal\", merchant_id=\"zibal\")\n</code></pre> <p>This will trigger mock responses from Zibal, allowing you to fully test your integration in a safe, non-production environment.</p>"},{"location":"gateways/zibal/usage/#2-create-a-payment-request","title":"2. Create a Payment Request","text":"<p>Prepare and send a payment request to Zibal with the desired amount and callback URL:</p> <pre><code>response = await pay.initiate_payment(\n    amount=10_000,  # Amount in IRR\n    callback_url=\"https://example.com/callback\",\n    description=\"Test Payment\",\n    order_id=\"order-123\"\n)\n\nif response.success:\n    track_id = response.track_id\n    print(f\"Track ID: {track_id}\")\nelse:\n    print(f\"Payment creation failed: {response.message}\")\n</code></pre>"},{"location":"gateways/zibal/usage/#3-redirect-user-to-payment-url","title":"3. Redirect User to Payment URL","text":"<p>Use the <code>track_id</code> returned from the payment request to generate the redirect URL:</p> <pre><code>if response.success:\n    payment_redirect_url = pay.get_payment_redirect_url(response.track_id)\n    print(f\"Redirect user to: {payment_redirect_url}\")\n    # In a web application, redirect the user to this URL\n</code></pre>"},{"location":"gateways/zibal/usage/#4-handle-the-callback","title":"4. Handle the Callback","text":"<p>After the payment process, Zibal will redirect the user back to your <code>callback_url</code> with payment result parameters via a <code>GET</code> request.</p> <p>The key query parameters are: - <code>trackId</code>: A unique identifier for the transaction - <code>success</code>: 1 if the transaction was successful, 0 otherwise - <code>status</code>: Payment status code - <code>orderId</code>: Your order identifier</p>"},{"location":"gateways/zibal/usage/#fastapi-callback-handler","title":"FastAPI Callback Handler","text":"<pre><code>from fastapi import FastAPI, Query\nfrom payman import Payman\n\napp = FastAPI()\npay = Payman(\"zibal\", merchant_id=\"your-merchant-id\")\n\n@app.get(\"/callback\")\nasync def handle_callback(\n    trackId: int = Query(..., alias=\"trackId\"),\n    success: int = Query(..., alias=\"success\"),\n    status: int = Query(..., alias=\"status\"),\n    orderId: str = Query(..., alias=\"orderId\")\n):\n    if success == 1:\n        # Payment was successful, verify it\n        verify_response = await pay.verify_payment(track_id=trackId)\n        if verify_response.success:\n            return {\"message\": \"Payment successful\", \"ref\": verify_response.ref_number}\n\n    return {\"message\": \"Payment failed or cancelled\"}\n</code></pre>"},{"location":"gateways/zibal/usage/#5-verify-payment","title":"5. Verify Payment","text":"<p>Once the user is redirected back, use the <code>track_id</code> to verify the payment with Zibal:</p> <pre><code># Async verification\nverify_response = await pay.verify_payment(track_id=track_id)\n\nif verify_response.success:\n    ref_number = verify_response.ref_number\n    print(f\"Bank Ref Number: {ref_number}\")\n    print(f\"Paid Amount: {verify_response.amount}\")\n    print(f\"Paid At: {verify_response.paid_at}\")\nelse:\n    print(f\"Verification failed: {verify_response.message}\")\n</code></pre>"},{"location":"gateways/zibal/usage/#complete-example","title":"Complete Example","text":"<p>Here's a complete working example:</p> <pre><code>import asyncio\nfrom payman import Payman, GatewayError\n\nasync def complete_payment_flow():\n    # Initialize gateway\n    pay = Payman(\"zibal\", merchant_id=\"zibal\")  # Sandbox mode\n\n    try:\n        # Step 1: Create payment\n        response = await pay.initiate_payment(\n            amount=25_000,\n            callback_url=\"https://your-site.com/callback\",\n            description=\"Order #123\",\n            order_id=\"order-123\",\n            mobile=\"09123456789\"\n        )\n\n        if not response.success:\n            print(f\"Payment creation failed: {response.message}\")\n            return\n\n        print(f\"Payment created successfully. Track ID: {response.track_id}\")\n\n        # Step 2: Get redirect URL\n        payment_url = pay.get_payment_redirect_url(response.track_id)\n        print(f\"Redirect user to: {payment_url}\")\n\n        # Step 3: Simulate user payment (in real app, user goes to payment_url)\n        print(\"User completes payment...\")\n\n        # Step 4: Verify payment\n        verify_response = await pay.verify_payment(track_id=response.track_id)\n\n        if verify_response.success:\n            print(f\"Payment verified! Ref: {verify_response.ref_number}\")\n            print(f\"Amount: {verify_response.amount} IRR\")\n            print(f\"Paid at: {verify_response.paid_at}\")\n        else:\n            print(f\"Verification failed: {verify_response.message}\")\n\n    except GatewayError as e:\n        print(f\"Gateway error: {e}\")\n    except Exception as e:\n        print(f\"Unexpected error: {e}\")\n\n# Run the example\nasyncio.run(complete_payment_flow())\n</code></pre>"},{"location":"gateways/zibal/usage/#payment-flow-summary","title":"Payment Flow Summary","text":"Step Description Method Response 1. Init Create Payman instance <code>Payman(\"zibal\", merchant_id=\"...\")</code> Gateway instance 2. Payment Send payment request <code>initiate_payment(...)</code> <code>PaymentResponse</code> with <code>track_id</code> 3. Redirect Get payment URL <code>get_payment_redirect_url(track_id)</code> Payment page URL 4. Callback Handle user return Extract params from request Callback parameters 5. Verify Confirm payment <code>verify_payment(track_id)</code> <code>VerifyResponse</code> with details"},{"location":"gateways/zibal/usage/#flexible-input-support","title":"Flexible Input Support","text":"<p>All Payman methods accept input in three flexible formats:</p>"},{"location":"gateways/zibal/usage/#1-pydantic-models","title":"1. Pydantic Models","text":"<pre><code>from zibal.models import PaymentRequest, VerifyRequest\n\n# Payment request\nrequest = PaymentRequest(\n    amount=10_000,\n    callback_url=\"https://site.com/callback\",\n    description=\"Test Payment\",\n    order_id=\"order-123\"\n)\nresponse = await pay.initiate_payment(request)\n\n# Verify request\nverify_request = VerifyRequest(track_id=123456)\nverify_response = await pay.verify_payment(verify_request)\n</code></pre>"},{"location":"gateways/zibal/usage/#2-dictionary-input","title":"2. Dictionary Input","text":"<pre><code># Payment request\nrequest_data = {\n    \"amount\": 10_000,\n    \"callback_url\": \"https://site.com/callback\",\n    \"description\": \"Test Payment\"\n}\nresponse = await pay.initiate_payment(request_data)\n\n# Verify request\nverify_data = {\"track_id\": 123456}\nverify_response = await pay.verify_payment(verify_data)\n</code></pre>"},{"location":"gateways/zibal/usage/#3-keyword-arguments","title":"3. Keyword Arguments","text":"<pre><code># Payment request\nresponse = await pay.initiate_payment(\n    amount=10_000,\n    callback_url=\"https://site.com/callback\",\n    description=\"Test Payment\"\n)\n\n# Verify request\nverify_response = await pay.verify_payment(track_id=123456)\n</code></pre>"},{"location":"gateways/zibal/usage/#input-validation","title":"Input Validation","text":"<p>All inputs are strictly validated using Pydantic, regardless of the input format:</p> <ul> <li>Field types are enforced (e.g., amount must be an int)</li> <li>Required fields are checked</li> <li>Invalid values raise immediate validation errors</li> <li>Clear error messages help with debugging</li> </ul>"},{"location":"gateways/zibal/usage/#validation-example","title":"Validation Example","text":"<pre><code>from pydantic import ValidationError\n\ntry:\n    response = await pay.initiate_payment(\n        amount=\"invalid\",  # \u274c This will raise ValidationError\n        callback_url=\"https://your-site.com\",\n        description=\"Example\"\n    )\nexcept ValidationError as e:\n    print(\"Validation error:\", e)\n</code></pre>"},{"location":"gateways/zibal/usage/#error-handling","title":"Error Handling","text":"<p>Payman provides comprehensive error handling for different scenarios:</p> <pre><code>from payman import GatewayError\nfrom zibal.exceptions import PaymentNotSuccessfulError, InvalidTrackIdError\n\ntry:\n    response = await pay.initiate_payment(...)\nexcept PaymentNotSuccessfulError as e:\n    print(f\"Payment failed: {e.message}\")\nexcept InvalidTrackIdError as e:\n    print(f\"Invalid track ID: {e.message}\")\nexcept GatewayError as e:\n    print(f\"Gateway error: {e}\")\nexcept Exception as e:\n    print(f\"Unexpected error: {e}\")\n</code></pre>"},{"location":"gateways/zibal/usage/#advanced-features","title":"Advanced Features","text":""},{"location":"gateways/zibal/usage/#custom-http-configuration","title":"Custom HTTP Configuration","text":"<pre><code>from payman import Payman\n\n# Configure HTTP client with custom settings\npay = Payman(\n    \"zibal\", \n    merchant_id=\"your-merchant-id\",\n    timeout=30.0,\n    max_retries=3,\n    retry_delay=1.0\n)\n</code></pre>"},{"location":"gateways/zibal/usage/#logging-configuration","title":"Logging Configuration","text":"<pre><code>import logging\n\n# Configure logging for Payman\nlogging.basicConfig(level=logging.DEBUG)\nlogger = logging.getLogger(\"payman\")\n\n# Payman will automatically use the configured logger\n</code></pre>"},{"location":"gateways/zibal/usage/#testing","title":"Testing","text":""},{"location":"gateways/zibal/usage/#sandbox-mode","title":"Sandbox Mode","text":"<p>Always test your integration using sandbox mode:</p> <pre><code># Use sandbox mode for testing\npay = Payman(\"zibal\", merchant_id=\"zibal\")\n\n# This will use mock responses\nresponse = await pay.initiate_payment(\n    amount=10_000,\n    callback_url=\"https://your-site.com/callback\"\n)\n</code></pre>"},{"location":"gateways/zibal/usage/#best-practices","title":"Best Practices","text":"<ol> <li>Always use HTTPS for callback URLs in production</li> <li>Validate amounts before sending to the gateway</li> <li>Store track_id securely for verification</li> <li>Handle all exceptions gracefully</li> <li>Use environment variables for sensitive data</li> <li>Test thoroughly in sandbox mode before going live</li> <li>Implement proper logging for debugging and monitoring</li> <li>Verify payments on your server, not just the client</li> <li>Use unique order_id for each transaction</li> <li>Implement idempotency for payment operations</li> </ol>"}]}